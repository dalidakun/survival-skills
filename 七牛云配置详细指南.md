# 七牛云配置详细指南

## 七牛云优势

✅ **永久链接**：可以生成长期有效的公开访问链接
✅ **国内访问快**：服务器在国内，访问速度快
✅ **免费额度充足**：10GB 存储 + 10GB/月下载流量
✅ **不需要 VPN**：国内用户可直接访问
✅ **完全免费**：无需信用卡，注册即可使用

## 免费额度说明

- **存储空间**：10GB（永久免费）
- **下载流量**：10GB/月（每月重置）
- **请求次数**：100万次/月

**对于您的需求**：
- 几百个 PDF，每个 15MB
- 假设 300 个 × 15MB = 4.5GB
- ✅ **在 10GB 免费额度内**

## 配置步骤

### 步骤 1：注册七牛云账户

1. 访问：https://www.qiniu.com/
2. 点击右上角 **"注册"**
3. 使用手机号或邮箱注册
4. 完成实名认证（可选，但建议完成以获得更多免费额度）

### 步骤 2：创建存储空间（Bucket）

1. 登录七牛云控制台
2. 点击左侧菜单 **"对象存储"** → **"空间管理"**
3. 点击 **"新建空间"**
4. 配置空间信息：
   - **空间名称**：`survival-skills-pdfs`（任意名称，不能重复）
   - **存储区域**：选择离您最近的区域（如：华东-浙江）
   - **访问控制**：选择 **"公开空间"**（重要！这样才能生成公开链接）
5. 点击 **"确定创建"**

### 步骤 3：获取 Access Key 和 Secret Key

1. 点击右上角头像 → **"密钥管理"**
2. 如果已有密钥，直接复制：
   - **AccessKey**
   - **SecretKey**
3. 如果没有密钥，点击 **"创建密钥"**：
   - 输入密钥名称（如：`survival-skills`）
   - 点击 **"确定"**
   - **重要**：复制并保存 AccessKey 和 SecretKey（只显示一次）

### 步骤 4：配置域名（可选，推荐）

#### 方式 A：使用七牛云测试域名（简单，但有限制）

- 七牛云会自动分配一个测试域名
- 格式：`http://空间名称.区域域名.qiniucs.com`
- **限制**：测试域名有 30 天有效期，需要绑定自定义域名

#### 方式 B：绑定自定义域名（推荐，永久有效）

1. 在空间设置中，点击 **"域名管理"**
2. 点击 **"绑定域名"**
3. 输入您的域名（如：`pdfs.yourdomain.com`）
4. 在您的域名 DNS 中添加 CNAME 记录
5. 等待域名验证通过

**如果没有自定义域名**：
- 可以先使用测试域名测试
- 后续再绑定自定义域名

### 步骤 5：在 Vercel 配置环境变量

1. 登录 Vercel Dashboard
2. 进入您的项目
3. 点击 **"Settings"** → **"Environment Variables"**
4. 添加以下环境变量：

| 变量名 | 值 | 说明 |
|--------|-----|------|
| `QINIU_ACCESS_KEY` | 您的 AccessKey | 从密钥管理获取 |
| `QINIU_SECRET_KEY` | 您的 SecretKey | 从密钥管理获取 |
| `QINIU_BUCKET_NAME` | 您的空间名称 | 例如：`survival-skills-pdfs` |
| `QINIU_DOMAIN` | 您的域名 | 测试域名或自定义域名 |

**示例**：
```
QINIU_ACCESS_KEY=your_access_key_here
QINIU_SECRET_KEY=your_secret_key_here
QINIU_BUCKET_NAME=survival-skills-pdfs
QINIU_DOMAIN=http://survival-skills-pdfs.区域域名.qiniucs.com
```

5. 保存并重新部署项目

### 步骤 6：测试上传

配置完成后，在管理后台上传一个 PDF 文件测试：
1. 登录管理后台
2. 选择"上传 PDF"模式
3. 选择一个 PDF 文件上传
4. 如果成功，会返回一个公开的 URL

## 获取永久链接

### 链接格式

上传成功后，文件会有一个公开访问 URL：

**使用测试域名**：
```
http://空间名称.区域域名.qiniucs.com/文件名.pdf
```

**使用自定义域名**：
```
https://您的域名.com/文件名.pdf
```

### 链接特点

- ✅ **永久有效**：只要文件不被删除，链接一直有效
- ✅ **公开访问**：任何人都可以通过链接访问
- ✅ **无需认证**：不需要登录或 Token
- ✅ **支持 HTTPS**：如果使用自定义域名并配置 SSL

## 注意事项

### 1. 空间访问控制

- 必须设置为 **"公开空间"** 才能生成公开链接
- 如果设置为私有空间，需要生成带签名的临时链接

### 2. 测试域名限制

- 测试域名有 30 天有效期
- 建议绑定自定义域名以获得永久链接

### 3. 流量监控

- 免费额度：10GB/月下载流量
- 如果超过，会产生费用（约 0.25 元/GB）
- 建议定期检查流量使用情况

### 4. 存储空间监控

- 免费额度：10GB 存储空间
- 如果超过，会产生费用（约 0.12 元/GB/月）
- 建议定期检查存储使用情况

## 费用说明

### 免费额度内（完全免费）

- 存储 ≤ 10GB
- 下载流量 ≤ 10GB/月
- 请求次数 ≤ 100万次/月

### 超出免费额度（按量付费）

- 存储：约 0.12 元/GB/月
- 下载流量：约 0.25 元/GB
- 请求次数：约 0.01 元/万次

**对于您的需求**（300 个 PDF，每个 15MB）：
- 存储：4.5GB < 10GB ✅ 免费
- 下载流量：取决于访问量，通常 < 10GB/月 ✅ 免费
- **预计完全免费使用**

## 故障排除

### 问题 1：上传失败，提示 "Access Denied"
- 检查 AccessKey 和 SecretKey 是否正确
- 检查空间名称是否正确
- 检查空间访问控制是否为"公开空间"

### 问题 2：上传成功但无法访问
- 检查空间访问控制是否为"公开空间"
- 检查域名配置是否正确
- 检查文件路径是否正确

### 问题 3：链接过期
- 如果使用测试域名，30 天后会过期
- 建议绑定自定义域名

## 下一步

配置完成后，代码会自动使用七牛云存储。您只需要：
1. 在管理后台上传 PDF
2. 系统会自动上传到七牛云
3. 返回公开的永久链接
4. 文章链接指向该 URL

## 总结

✅ **七牛云可以生成永久链接**
✅ **免费额度足够使用**（10GB 存储）
✅ **国内访问速度快**
✅ **不需要 VPN**
✅ **配置简单**

**推荐使用七牛云作为 PDF 存储方案！**

